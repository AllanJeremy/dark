#!/bin/bash

set -euo pipefail

echo "Building docker image"
docker build -t dark .

# echo "Removing all containers"
# docker rm -f $(docker ps -a -q) || true

echo "watching for local changes"
scripts/support/reload-browser > logs/browser.log 2>&1 &

echo "Run the build"
fswatch -m fsevents_monitor \
        --event-flag-separator=, \
        -r * \
        -x "$@" \
    | docker run \
             --rm \
             -i \
             -v "$PWD":/home/dark/app \
             -p 8000:8000 \
             -w /home/dark/app \
             dark \
             scripts/support/build-server
