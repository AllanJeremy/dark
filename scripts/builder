#!/bin/bash

set -euo pipefail

echo "Building docker image"
docker build -t dark .

echo "Removing all containers"
docker rm -f $(docker ps -a -q) || true

echo "watching for local changes"
scripts/support/reload-browser > logs/browser.log 2>&1 &

echo "Run the build"
docker run \
       -t \
       -v $(pwd):/home/dark/app \
       -p 8000:8000 \
       dark \
       sh -c 'cd app && scripts/support/build-watcher'
