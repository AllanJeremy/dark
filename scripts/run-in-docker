#!/bin/bash

set -euo pipefail

# Replace any filenames with the in-container filenames (stdin)
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )"/.. && pwd )"
ARGS=${@}
ARGS=$(echo ${ARGS} | sed -e "s!$DIR!/home/dark/app!g")

NAME=$(docker ps --latest --quiet)

if [ -t 0 ] ;
then
  docker exec -it "${NAME}" ${ARGS}
else
  # Replace any filenames with the in-container filenames (stdout)
  { docker exec -i "${NAME}" ${ARGS} 2>&1 1>&3 3>&- | sed -e "s!/home/dark/app!$DIR!g"; } 3>&1 1>&2 | sed -e "s!/home/dark/app!$DIR!g"
fi
