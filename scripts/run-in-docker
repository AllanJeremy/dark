#!/bin/bash

set -euo pipefail

function fix_dir {
  sed -e "s!$DIR!/home/dark/app!g"
}

# Replace any filenames with the in-container filenames (stdin)
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )"/.. && pwd )"
ARGS=${@}
ARGS=$(echo ${ARGS} | fix_dir)

NAME=$(docker ps --latest --quiet)

if [ -t 0 ] ;
then
  docker exec -it "${NAME}" ${ARGS}
else
  # Replace any filenames with the in-container filenames (stdout + stderr)
  { fix_dir | docker exec -i "${NAME}" ${ARGS} 2>&1 1>&3 3>&- | fix_dir; } 3>&1 1>&2 | fix_dir
fi
